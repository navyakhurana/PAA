<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-project-panel/basic/explore-the-components/components/Multitenancy">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Deep Dive into Multitenancy | Build resilient apps with SAP BTP</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://navyakhurana.github.io/PAA/project-panel/basic/explore-the-components/components/Multitenancy"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deep Dive into Multitenancy | Build resilient apps with SAP BTP"><meta data-rh="true" name="description" content="In this part of the tutorial, you will learn about different aspects of multitenancy and how multitenancy is handled by the SaaS application."><meta data-rh="true" property="og:description" content="In this part of the tutorial, you will learn about different aspects of multitenancy and how multitenancy is handled by the SaaS application."><link data-rh="true" rel="icon" href="/PAA/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://navyakhurana.github.io/PAA/project-panel/basic/explore-the-components/components/Multitenancy"><link data-rh="true" rel="alternate" href="https://navyakhurana.github.io/PAA/project-panel/basic/explore-the-components/components/Multitenancy" hreflang="en"><link data-rh="true" rel="alternate" href="https://navyakhurana.github.io/PAA/project-panel/basic/explore-the-components/components/Multitenancy" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SX6JA1B3F5-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Build resilient apps with SAP BTP" href="/PAA/opensearch.xml">

<script src="js/custom.js" async></script><link rel="stylesheet" href="/PAA/assets/css/styles.f9497dcc.css">
<link rel="preload" href="/PAA/assets/js/runtime~main.7d666486.js" as="script">
<link rel="preload" href="/PAA/assets/js/main.79499448.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/PAA/"><div class="navbar__logo"><img src="/PAA/img/githubFolder.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/PAA/img/githubFolder.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Develop a multitenant Software as a Service application in SAP BTP using CAP</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/SAP-samples/btp-kyma-cap-multitenant-susaas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PAA/">OVERVIEW</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/PAA/category/project-panel">PROJECT PANEL</a><button aria-label="Toggle the collapsible sidebar category &#x27;PROJECT PANEL&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/category/discover">Discover</a><button aria-label="Toggle the collapsible sidebar category &#x27;Discover&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/category/basic">Basic</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basic&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/introduction-basic-version">Introduction to the Basic Version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/understand-repo-structure">Understand the Repository Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/prepare-provider-subaccount">Prepare the Provider Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/build-your-docker-images">Build, Pack and Push your Docker Images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/deploy-saas-application">Deploy the SaaS application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/subscribe-consumer-subaccount">Subscribe a Tenant Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/push-data-to-saas-api">Push data to the SaaS API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/test-the-application">Test the application</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/project-panel/basic/kyma-resources-helm">Helm Charts and Kyma resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm Charts and Kyma resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/project-panel/basic/explore-the-components">Explore the application components</a><button aria-label="Toggle the collapsible sidebar category &#x27;Explore the application components&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/category/components-1">Components</a><button aria-label="Toggle the collapsible sidebar category &#x27;Components&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/explore-the-components/components/HelperClasses">Deep Dive into Helper Classes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/PAA/project-panel/basic/explore-the-components/components/Multitenancy">Deep Dive into Multitenancy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/explore-the-components/components/ServiceBrokers">Deep Dive into Service Brokers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/explore-the-components/components/SharedContainer">Shared Database Container</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/unsubscribe-consumer-subaccount">Optional - Unsubscribe from a Consumer Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/project-panel/basic/undeploy-saas-application">Optional - Undeploy the SaaS Application</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/category/advanced">Advanced</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/category/expert">Expert</a><button aria-label="Toggle the collapsible sidebar category &#x27;Expert&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PAA/support">SUPPORT</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/PAA/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/category/project-panel"><span itemprop="name">PROJECT PANEL</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/category/basic"><span itemprop="name">Basic</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/project-panel/basic/explore-the-components"><span itemprop="name">Explore the application components</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/category/components-1"><span itemprop="name">Components</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deep Dive into Multitenancy</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deep Dive into Multitenancy</h1><p>In this part of the tutorial, you will learn about different aspects of multitenancy and how multitenancy is handled by the SaaS application.</p><ol><li><p><a href="#1-Application-Router">Application Router</a><br>
<!-- -->1.1. <a href="#11-Application-Router-and-identity-zones">Application Router and identity zones</a><br>
<!-- -->1.2. <a href="#12-Application-Router-and-multitenancy-authentication">Application Router and multitenancy authentication</a></p></li><li><p><a href="#2-Authorization-&amp;-Trust-management-service">Authorization &amp; Trust management service</a><br>
<!-- -->2.1. <a href="#21-Authorization-&amp;-Trust-management-service---shared-tenant-mode">shared tenant-mode</a><br>
<!-- -->2.2. <a href="#22-Authorization-&amp;-Trust-management-service---application-plan">application plan</a></p></li><li><p><a href="#3-further-information">Further Information</a></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-application-router">1. Application Router<a href="#1-application-router" class="hash-link" aria-label="Direct link to 1. Application Router" title="Direct link to 1. Application Router">​</a></h2><p>The application router is the single point of entry for most applications running in SAP BTP. The application router is used to serve static content, authenticate users, rewrite URLs, and forward or proxy requests to other microservices while propagating user information. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-application-router-and-identity-zones">1.1. Application Router and identity zones<a href="#11-application-router-and-identity-zones" class="hash-link" aria-label="Direct link to 1.1. Application Router and identity zones" title="Direct link to 1.1. Application Router and identity zones">​</a></h3><p>Each multitenant application has to deploy its own application router, and the application router handles requests of all Tenants to the application. The application router can determine the Tenant identifier from the URL subdomain and then forwards the authentication request to the User Account and Authentication (UAA) service and the related identity zone. Each identity zone can be uniquely identified by a subdomain identifier. An identity zone is a logical boundary around the entities UAA manages. </p><p>Those entities in a zone include and define e.g.:</p><ul><li>Users</li><li>Group mappings</li><li>Identity providers (IDPs) and access</li></ul><p>This allows each Tenant Subaccount to handle users and authentication processes independently by e.g. using a custom IDP. As each request to the application router is forwarded to the correct identity zone, this allows a very flexible authentication approach. To read more about identity zones please refer to the official Cloud Foundry documentation (<a href="https://docs.cloudfoundry.org/uaa/uaa-concepts.html#iz" target="_blank" rel="noopener noreferrer">click here</a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-application-router-and-multitenancy-authentication">1.2. Application Router and multitenancy authentication<a href="#12-application-router-and-multitenancy-authentication" class="hash-link" aria-label="Direct link to 1.2. Application Router and multitenancy authentication" title="Direct link to 1.2. Application Router and multitenancy authentication">​</a></h3><p>The following steps are happening during the authentication of Consumer requests in a multitenant application. To learn more about the prerequisites like tenant-mode <strong>shared</strong> and the <strong>application</strong> service plan, please read the following sections providing more details. </p><p>The application router must determine the tenant-specific subdomain for the UAA that in turn determines the identity zone, used for authentication. This determination is done by the <code>TENANT_HOST_PATTERN</code> environment variable. The <code>TENANT_HOST_PATTERN</code> is a string containing a regular expression with a capturing group. The request-host is matched against this regular expression. The value of the first capturing group is used as the Tenant subdomain.</p><p>If you have multiple routes to the same application, for example <code>tenant1.&lt;application domain&gt;</code> and <code>tenant2.&lt;application domain&gt;</code> the respective <code>TENANT_HOST_PATTERN</code> could be <code>^(.*).&lt;application domain&gt;</code> capturing the group <code>tenant1</code> and <code>tenant2</code>.</p><p>This URL-based method of identifying a Tenant by handling consumer-specific authentication requirements is also depicted in the following visualization. Together with the steps described below, you should get a good idea of how multitenancy in SAP BTP is implemented. </p><p><img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/AR_Flow.png&amp;quot; width=&amp;quot;800&amp;quot;/&amp;gt;" src="/PAA/assets/images/AR_Flow-3ef327d77ccedbe97ee7bb0f4c01b4f7.png" width="2016" height="954" class="img_ev3q"></p><p>1) The application router derives the identity zone identifier from the URL using the <code>TENANT_HOST_PATTERN</code> approach described above. Each Consumer Subaccount maps to a unique identity zone and a unique subdomain associated with this identity zone. </p><p>2) The application router calls the tenant-aware XSUAA service, which is responsible for the authentication of the business user.</p><p>3) XSUAA reads the Tenant and gets the consumer-specific identity provider (IdP) from the tenant-specific identity zone. </p><p>4) XSUAA delegates the authentication to the configured IdP, and creates a JSON Web Token (JWT) that contains the tenant, the current user, and the authorization scopes of the user. </p><p>5) The JWT is then sent back to the application router, and from there to the application.</p><p>6) To read and store tenant-specific data, the multitenant application needs to know the Tenant ID. </p><p>7) To retrieve the Tenant ID, the multitenant application reads the tenant, user, and scopes from the given JWT. </p><p>8) The Tenant information is contained in the identityZone user attribute.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt;Sample Java Code to get the user&#x27;s identityZone   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;UserInfo userInfo = SecurityContext.getUserInfo();    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;String identityZone = userInfo.getIdentityZone();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-authorization--trust-management-service">2. Authorization &amp; Trust management service<a href="#2-authorization--trust-management-service" class="hash-link" aria-label="Direct link to 2. Authorization &amp; Trust management service" title="Direct link to 2. Authorization &amp; Trust management service">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-authorization--trust-management-service---shared-tenant-mode">2.1. Authorization &amp; Trust management service - <strong>shared</strong> tenant-mode<a href="#21-authorization--trust-management-service---shared-tenant-mode" class="hash-link" aria-label="Direct link to 21-authorization--trust-management-service---shared-tenant-mode" title="Direct link to 21-authorization--trust-management-service---shared-tenant-mode">​</a></h3><p>The tenant-mode <strong>shared</strong> allows you to share a UAA service instance of type <strong>application</strong> in a multitenant scenario. This is a central requirement of a multitenant application, as otherwise a separate UAA service instance would be required in each and every Consumer Subaccount. As all Tenants share the same XSUAA instance and only the authentication is delegated to the respective Tenant identity zone, this is a great process simplification.  </p><p>In a normal scenario in which the tenant-mode <strong>dedicated</strong> is set, XSUAA (overall) would only issue a token for a user, if he authenticates against the identity-zone in which the Auth. &amp; Trust mgmt. service instance was created. If a user would authenticate using another identity-zone authentication endpoint (e.g. <strong>consumer</strong>.authentication.eu10.hana.ondemand.com), using the same Client-ID and Client Secret of the service binding, it fails. The Client-ID and Client Secret can only be used by a <strong>dedicated</strong> identity-zone which is the identity zone in which the Auth. &amp; Trust Management service instance was created. </p><p>In a tenant-mode <strong>shared</strong> scenario, XSUAA (Overall) will also issue tokens to users authenticating via other identit -zones (e.g., consumer.authentication.eu10.hana.ondemand.com), using the same Client-ID and Client-Secret which is bound to the application router via service binding to retrieve the token. Nevertheless, XSUAA will only issue a token for identity zones of Consumer Subaccounts and keeps track of these Consumer identity-zones. The Auth. &amp; Trust mgmt. service instance though will be <strong>shared</strong> among multiple identity zones and allows authentication using the exact same Client-ID and Client-Secret (taken from the service binding of the application router) for users authenticated via various identity zones. </p><p>After authenticating with the <strong>shared</strong> client credentials to the identity zone of the consumer, XSUAA will issue the respective scopes of the user within the Consumer Subaccount. These scopes are generated in the Consumer Subaccount upon subscription and have the same values in each and every subaccount based on the <code>&lt;xsappname&gt;!t&lt;tenant index&gt;</code> format mentioned in the <strong>application</strong> plan like e.g. &quot;dev-susaas!t134415.Admin&quot;,</p><p>Below you can see two screenshots of the provider service credentials and a token issued for one of the Consumer tenants. You can see that the Consumer token has been issued using the Client-ID of the Provider Subaccount Auth. &amp; Trust mgmt. service instance. Still, the identity zone (zid) differs from the identity zone of the Provider Subaccount. </p><p><strong>Client Credentials</strong> (Provider subaccount)</p><p><img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/AR_ProvCred.png&amp;quot; width=&amp;quot;400&amp;quot;/&amp;gt;" src="/PAA/assets/images/AR_ProvCred-74b31ef1e95d9bacfc7e98087896b176.png" width="1854" height="1184" class="img_ev3q"></p><p><strong>Authorization Token</strong> (Tenant subaccount)</p><p><img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/AR_SubscrToken.png&amp;quot; width=&amp;quot;400&amp;quot;/&amp;gt;" src="/PAA/assets/images/AR_SubscrToken-3ac779ac836fa550201919693777d140.png" width="1058" height="1268" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-authorization--trust-management-service---application-plan">2.2. Authorization &amp; Trust management service - <strong>application</strong> plan<a href="#22-authorization--trust-management-service---application-plan" class="hash-link" aria-label="Direct link to 22-authorization--trust-management-service---application-plan" title="Direct link to 22-authorization--trust-management-service---application-plan">​</a></h3><p>The service plan <strong>application</strong> requires that the xsappname (specified in the xs-security.json or mta.yaml file) is unique in each Tenant (SAP BTP subaccount) to which the application is deployed. This means that an application may be deployed in several SAP BTP subaccounts at the same time but not twice in the same Tenant (unless you modify the xsappname). You would get an error message during the second deployment. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>In the sample application, the xsappname is dynamically combined with the current Kyma namespace so you can deploy the application to multiple namespaces in the same cluster if you like. </p></div></div><p>The xsappname that is written into the credentials section of the environment is enhanced with a suffix and has the format <code>&lt;xsappname&gt;!t&lt;tenant index&gt;</code>. A Tenant index is a running number that the UAA maintains internally. It differs from subaccount to subaccount. </p><p>In a multitenant scenario, the actual application instances only exist in the Provider Subaccount, whereas XSUAA-related objects like scopes, role templates, and role collections are duplicated during the subscription process. Scopes have an equal format <code>&lt;xsappname&gt;!t&lt;tenant index&gt;.&lt;scope&gt;</code> in all Consumer Subaccounts e.g. <strong>dev-susaas!t134415.Admin</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-further-information">3. Further information<a href="#3-further-information" class="hash-link" aria-label="Direct link to 3. Further information" title="Direct link to 3. Further information">​</a></h2><p>Please use the following links to find further information on the topics above:</p><ul><li><a href="https://help.sap.com/docs/BTP/65de2977205c403bbc107264b8eccf4b/5af9067322214e8dbf354daae44cef08.html?locale=en-US" target="_blank" rel="noopener noreferrer">SAP Help - Multitenancy Configure the approuter Application</a></li><li><a href="https://blogs.sap.com/2022/08/27/fundamentals-of-multitenancy-in-sap-btp/" target="_blank" rel="noopener noreferrer">SAP Blog - Fundamentals of Multitenancy in SAP BTP</a></li><li><a href="https://help.sap.com/docs/HANA_CLOUD_DATABASE/b9902c314aef4afb8f7a29bf8c5b37b3/6d3ed64092f748cbac691abc5fe52985.html#tenant-mode" target="_blank" rel="noopener noreferrer">SAP Help - Tenant Mode: Shared</a></li><li><a href="https://help.sap.com/docs/HANA_CLOUD_DATABASE/b9902c314aef4afb8f7a29bf8c5b37b3/c6f36d5d49844bd790798ea36538e024.html?locale=en-US&amp;version=2022_3_QRC#xsuaa-service-plan%3A-%E2%80%9Capplication%E2%80%9D" target="_blank" rel="noopener noreferrer">SAP Help - XSUAA Service Plan: &quot;application&quot;</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-29T06:17:59.000Z">Aug 29, 2023</time></b> by <b>Navya khurana</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/PAA/project-panel/basic/explore-the-components/components/HelperClasses"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deep Dive into Helper Classes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/PAA/project-panel/basic/explore-the-components/components/ServiceBrokers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deep Dive into Service Brokers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-application-router" class="table-of-contents__link toc-highlight">1. Application Router</a><ul><li><a href="#11-application-router-and-identity-zones" class="table-of-contents__link toc-highlight">1.1. Application Router and identity zones</a></li><li><a href="#12-application-router-and-multitenancy-authentication" class="table-of-contents__link toc-highlight">1.2. Application Router and multitenancy authentication</a></li></ul></li><li><a href="#2-authorization--trust-management-service" class="table-of-contents__link toc-highlight">2. Authorization &amp; Trust management service</a><ul><li><a href="#21-authorization--trust-management-service---shared-tenant-mode" class="table-of-contents__link toc-highlight">2.1. Authorization &amp; Trust management service - <strong>shared</strong> tenant-mode</a></li><li><a href="#22-authorization--trust-management-service---application-plan" class="table-of-contents__link toc-highlight">2.2. Authorization &amp; Trust management service - <strong>application</strong> plan</a></li></ul></li><li><a href="#3-further-information" class="table-of-contents__link toc-highlight">3. Further information</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/PAA/">Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">SAP Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blogs.sap.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blogs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://answers.sap.com/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Q&amp;A<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discovery-center.cloud.sap/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discovery Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/SAP-samples/btp-kyma-cap-multitenant-susaas" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/PAA/assets/js/runtime~main.7d666486.js"></script>
<script src="/PAA/assets/js/main.79499448.js"></script>
</body>
</html>