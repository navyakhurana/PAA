<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-project-panel/basic/kyma-resources-helm/components/TemplateDetails">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Template Details | Build resilient apps with SAP BTP (PR: #6)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/TemplateDetails"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Template Details | Build resilient apps with SAP BTP (PR: #6)"><meta data-rh="true" name="description" content="This chapter provides detailed information on the various Helm templates and corresponding Kyma and Kubernetes resources. If you are new to Helm and have not checked out the provided introduction yet, we strongly recommend to read the respective Helm Charts chapter first. While the subsequent Resource Overview chapter describes the general purpose of the different Kyma and Kubernetes resource types, in this part of the tutorial, we cover the scenario-related usage of the various components."><meta data-rh="true" property="og:description" content="This chapter provides detailed information on the various Helm templates and corresponding Kyma and Kubernetes resources. If you are new to Helm and have not checked out the provided introduction yet, we strongly recommend to read the respective Helm Charts chapter first. While the subsequent Resource Overview chapter describes the general purpose of the different Kyma and Kubernetes resource types, in this part of the tutorial, we cover the scenario-related usage of the various components."><link data-rh="true" rel="icon" href="/PAA/@navyakhurana-patch-3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/TemplateDetails"><link data-rh="true" rel="alternate" href="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/TemplateDetails" hreflang="en"><link data-rh="true" rel="alternate" href="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/TemplateDetails" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SX6JA1B3F5-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Build resilient apps with SAP BTP (PR: #6)" href="/PAA/@navyakhurana-patch-3/opensearch.xml">

<script src="js/custom.js" async></script><link rel="stylesheet" href="/PAA/@navyakhurana-patch-3/assets/css/styles.f9497dcc.css">
<link rel="preload" href="/PAA/@navyakhurana-patch-3/assets/js/runtime~main.09ce6886.js" as="script">
<link rel="preload" href="/PAA/@navyakhurana-patch-3/assets/js/main.7708be93.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://github.com/navyakhurana/PAA/pull/6" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/PAA/@navyakhurana-patch-3/img/githubFolder.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/PAA/@navyakhurana-patch-3/img/githubFolder.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Develop a multitenant Software as a Service application in SAP BTP using CAP (PR: #6)</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/SAP-samples/btp-kyma-cap-multitenant-susaas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PAA/@navyakhurana-patch-3/">OVERVIEW</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/PAA/@navyakhurana-patch-3/category/project-panel">PROJECT PANEL</a><button aria-label="Toggle the collapsible sidebar category &#x27;PROJECT PANEL&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/discover">Discover</a><button aria-label="Toggle the collapsible sidebar category &#x27;Discover&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/basic">Basic</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basic&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/introduction-basic-version">Introduction to the Basic Version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/understand-repo-structure">Understand the Repository Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/prepare-provider-subaccount">Prepare the Provider Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/build-your-docker-images">Build, Pack and Push your Docker Images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/deploy-saas-application">Deploy the SaaS application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/subscribe-consumer-subaccount">Subscribe a Tenant Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/push-data-to-saas-api">Push data to the SaaS API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/test-the-application">Test the application</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm">Helm Charts and Kyma resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm Charts and Kyma resources&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/components">Components</a><button aria-label="Toggle the collapsible sidebar category &#x27;Components&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/HelmCharts">Helm Charts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/ResourceOverview">Resource Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/TemplateDetails">Template Details</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/explore-the-components">Explore the application components</a><button aria-label="Toggle the collapsible sidebar category &#x27;Explore the application components&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/unsubscribe-consumer-subaccount">Optional - Unsubscribe from a Consumer Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/basic/undeploy-saas-application">Optional - Undeploy the SaaS Application</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/advanced">Advanced</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/expert">Expert</a><button aria-label="Toggle the collapsible sidebar category &#x27;Expert&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PAA/@navyakhurana-patch-3/support">SUPPORT</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/PAA/@navyakhurana-patch-3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/@navyakhurana-patch-3/category/project-panel"><span itemprop="name">PROJECT PANEL</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/@navyakhurana-patch-3/category/basic"><span itemprop="name">Basic</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm"><span itemprop="name">Helm Charts and Kyma resources</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/@navyakhurana-patch-3/category/components"><span itemprop="name">Components</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Template Details</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Template Details</h1><p>This chapter provides detailed information on the various Helm templates and corresponding Kyma and Kubernetes resources. If you are new to Helm and have not checked out the provided introduction yet, we strongly recommend to read the respective <a href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/HelmCharts">Helm Charts</a> chapter first. While the subsequent <a href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/ResourceOverview">Resource Overview</a> chapter describes the general purpose of the different Kyma and Kubernetes resource types, in this part of the tutorial, we cover the scenario-related usage of the various components.</p><ul><li><a href="#template-details">Template Details</a><ul><li><a href="#umbrella-chart">Umbrella Chart</a></li><li><a href="#api-service">API Service</a></li><li><a href="#api-service-broker">API Service Broker</a></li><li><a href="#application-router">Application Router</a></li><li><a href="#saas-backend-service">SaaS Backend Service</a></li></ul></li></ul><p>Once again, you might find the following visualizations useful, as you will be able identify and allocate many of the described resources. </p><p><strong>Architecture Diagram</strong></p><p><img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/ResourceDetailsArch.png&amp;quot; width=&amp;quot;600&amp;quot;/&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/ResourceDetailsArch-413621d553782d75563c31cf33071cfd.png" width="1716" height="986" class="img_ev3q"></p><p><strong>Component Details</strong></p><p><img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/KymaObjectsGeneral.png&amp;quot; width=&amp;quot;600&amp;quot;/&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/KymaObjectsGeneral-21d4e7fc56d23fefdb216545e99a0bc9.png" width="1516" height="820" class="img_ev3q"></p><p>The recommended way to deploy our Sustainable SaaS sample application is the usage of the provided Helm Umbrella Chart. Doing so, you can maintain all environment specific settings in one place (values.yaml) and deploy all Helm Subcharts using one single Helm installation. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="umbrella-chart">Umbrella Chart<a href="#umbrella-chart" class="hash-link" aria-label="Direct link to Umbrella Chart" title="Direct link to Umbrella Chart">â€‹</a></h2><p>The Umbrella Chart <em>/charts/sustainable-saas</em> directory, allows you to conduct a Helm installation including all relevant components of the Sustainable SaaS sample application like Application Router, Backend Service, API Broker and API Service. Furthermore, it contains the templates for all required SAP BTP Service Instances, as well as Kubernetes Job templates for the SAP HANA and HTML5 Application Deployments. </p><p>For a default installation, it is sufficient to update the <strong>values.yaml</strong> file (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/values.yaml">values.yaml</a>) of the Helm Umbrella Chart with your own environment settings, before starting a Helm installation. Still, all required values are also available in the respective Subcharts. Therefore, it is also possible to install the different Subcharts like the Application Router or the Backend Service separately, by copying the properties from the Helm Umbrella Chart <em>values.yaml</em> file to the respective <em>values.yaml</em> files of the Subcharts. </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Chart.yaml          # Helm Umbrella Chart referencing all Subcharts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.schema.json  # Schema definition for Values.yaml file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.yaml         # values.yaml for Helm Umbrella Chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xs-security.json    # Settings for XSUAA Service Instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Good to know</strong></p><ul><li><p>As most SAP BTP services (e.g. XSUAA) are used by multiple components of our application (e.g. Application Router and Backend Service), we defined the SAP BTP Service Instances on Umbrella Chart level. An alternative approach would be a separate Helm Subchart, being used to create the shared SAP BTP Service Instances. </p></li><li><p>While processing the XSUAA Service Instance template, Helm will read and include the provided <em>xs-security.json</em> configuration file. If you reference further configuration files in your <em>values.yaml</em>, you need to place the respective files next to your <em>values.yaml</em> file. </p></li></ul><p>*<strong>*charts/sustainable-saas/templates**</strong></p><p>The <strong>templates</strong> directory of the Helm Umbrella Chart contains templates for all SAP BTP Service Instances, as well as templates for our Kubernetes Jobs. Additionally, the directory contains some template helper files used by Helm. </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Service Broker Secret definition        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker_secret.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP HANA HDI Container definition (Shared/Common Container)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com_hdi_container.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP BTP - Destination Service definition           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">destination.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP HANA Deployer (Shared/Common Container) Job definition      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hana_deployer_job.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HTML5 Repository Deployer Job definition        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">html5_apps_deployer_job.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HTML5 Application Repository (Host Service) definition  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">html5_apps_repo_host.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HTML5 Application Repository (Runtime Service) definition     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">html5_apps_repo_runtime.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cloud Identity Service (Application) definition     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">identity.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Helm deployment message definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NOTES.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP BTP - SaaS Registry Service definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">saas_registry.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP BTP - Service Manager (Subaccount Admin plan) Service definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sm_admin.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP BTP - Service Manager (Container plan) Service definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sm_container.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP BTP - XSUAA Service definition (for SaaS App) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xsuaa.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SAP BTP - XSUAA Service definition (for SaaS API)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xsuaa_api.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Helm templating helper file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_deployment_helpers.tpl </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Helm templating helper file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_helpers.tpl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Helm templating helper file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_sapcp_helpers.tpl </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Good to know</strong></p><ul><li><p>The SAP BTP Service Instance templates need to match the names of the services defined in the <a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/values.yaml"><strong>values.yaml file</strong></a> of the Umbrella Chart, whereas underscores are converted to hyphens automatically. For each Service Instance defined in the values.yaml file, a corresponding template file has to exist. Otherwise, the Service Instance is not being generated. </p></li><li><p>The <strong>Broker Secret</strong> automatically generates a Service Broker user and password upon deployment. Binding the Secret to the API Service Broker and the Backend Service allows simplified retrieval of these credentials at runtime.</p><blockquote><p><strong>broker_secret.yaml</strong></p></blockquote><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Opaque</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Broker user set to default value &quot;broker-user&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">BROKER_USER</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> &quot;broker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">user&quot; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> b64enc </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> quote </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Broker password created as a random alpha numeric string of 32 characters length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $password </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= (randAlphaNum 32  </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> b64enc ) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">BROKER_PASSWORD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> $password </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> quote </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>The Helm Job templates for deploying the UI5 apps to the HTML5 Application Repository (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/templates/html5_apps_deployer_job.yaml">click here</a>) and the shared data model to the HDI Container instance (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/templates/hana_deployer_job.yaml.yaml">click here</a>), are also part of the Helm Umbrella Chart templates.</p></li><li><p>The Service Manager Instance (<strong>Subaccount Admin</strong> plan - <a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/templates/sm_admin.yaml">click here</a>) allows our sample application to create a so-called Cloud Management Service Instance (<strong>Central</strong> plan) at runtime (<a href="https://discovery-center.cloud.sap/serviceCatalog/cloud-management-service/?region=all" target="_blank" rel="noopener noreferrer">click here</a> for details). This Service Instance created at runtime, is required to create Service Manager Instances in the Subscriber Subaccounts. These Service Manager Instances can then be used to register API Service Brokers in the Subscriber Subaccounts.
</p></li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>The default Service Manager Service Instance (<strong>Operator Access</strong> plan) - used by Kyma to create Service Instances in the Provider Subaccount - can unfortunately not be used to create the required CIS Central instance. </p></div></div><ul><li><p>As already explained, each Service Instance defined in the <em>values.yaml</em> file requires a corresponding template in the <em>templates</em> folder. Most of these template files, simply include a template reference (<em>cap.service-instance</em>) defined in the <em>_helpers.tpl</em> helper file. This generic approach saves us from defining dedicated SAP BTP Service Instance templates for each SAP BTP Service Instance.</p><blockquote><p><strong>sm_admin.yaml</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> include &quot;cap.service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">instance&quot; . </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><blockquote><p><strong>_helpers.tpl</strong></p></blockquote><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Helm template for SAP BTP Service Instances</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> define &quot;cap.service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">instance&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $service </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= get .Values $key </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> if $service </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> if or (not (hasKey $service &quot;enabled&quot;)) $service.enabled </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $name </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= $key </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> replace &quot;_&quot; &quot;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $serviceParameters </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= $service.parameters </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> default (dict) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> end </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> end </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Some Services Instance templates like the SaaS Registry require a slightly more complex template file. This is required when any of the Service Instance parameters requires dynamic values like e.g., the Backend Service URI as part of the getDependencies parameter below. If these parameters contain dynamic components, they cannot be provided as part of the static <em>values.yaml</em> file.</p><blockquote><p><strong>saas_registry.yaml</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> if (default dict .Values.multitenancy).enabled </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Include additional service configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $srvHostFull </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= include &quot;cap.deploymentHostFull&quot; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          merge (dict &quot;name&quot; &quot;srv&quot; &quot;deployment&quot; .Values.srv) . </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $defaultAppUrls </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;getDependencies&quot; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print &quot;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//&quot; $srvHostFull &quot;/</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">/cds/saas</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">provisioning/dependencies&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Include default SAP BTP Service Instance template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> include &quot;cap.service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">instance&quot; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          merge ( dict &quot;defaultParameters&quot; $defaultParameters ) .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> end </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote></li><li><p>Some SAP BTP Services Instances templates also use the so-called <a href="#https://helm.sh/docs/howto/charts_tips_and_tricks/#using-the-tpl-function">Helm <strong>tpl</strong> function</a>. The tpl feature allows us to use the Helm template syntax in the <em>values.yaml</em> file. One example is the Destination Service, which uses Helm template syntax within the <em>init_data</em> parameters (of the <em>values.yaml</em>). This allows us to inject the dynamic values like the Backend Service URI into the SAP BTP Destination Service Instance parameters.</p><blockquote><p><strong>values.yaml</strong></p></blockquote><p>  Using Helm templating syntax in the parameter values. </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">destination</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceOfferingName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">servicePlanName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">init_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">destinations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> srv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &#x27;http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> include &quot;cap.fullname&quot; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    merge (dict &quot;name&quot; &quot;srv&quot; &quot;deployment&quot; .Values.srv ) . </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  ) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.srv.port </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>destination.yaml</strong></p></blockquote><p>  Sends the <strong>init_data</strong> parameters (containing Helm templating syntax) to a helper function.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> if (default dict .Values.multitenancy).enabled </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Apply template definitions provided in init_data values of the values.yaml file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $defaultParameters </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">= dict &quot;init_data&quot; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          include &quot;template</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">value&quot; ( dict &quot;value&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ( .Values.destination.parameters.init_data &quot;context&quot; . ) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ) </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> fromYaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Include default SAP BTP Service Instance template and merge parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> include &quot;cap.service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">instance&quot; (  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          merge ( dict &quot;defaultParameters&quot; $defaultParameters ) . </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> end </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>_helpers.tpl</strong></p></blockquote><p>  The Helm helper function &quot;translates&quot; the templating syntax as required. </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> define &quot;template</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">value&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> if kindIs &quot;string&quot; .value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The tpl function replaces e.g. {{ .Values.srv.port }} with the respective value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># It also applies the provided includes to build the correct Backend Service URI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tpl .value .context </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> else </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tpl (.value </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> toYaml) .context </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> end </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> end </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  A sample resource definition generated by Helm could look like the following. </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> services.cloud.sap.com/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceInstance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> susaas</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceOfferingName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">servicePlanName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">externalName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">susaas</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">init_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">destinations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HTTP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Target URL contains the dynamic Helm Release Name and correct Port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//susaas</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">srv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-service">API Service<a href="#api-service" class="hash-link" aria-label="Direct link to API Service" title="Direct link to API Service">â€‹</a></h2><p>The Sustainable SaaS API Service is defined as a separate Helm Subchart. Theoretically, this Subchart can also be deployed standalone, by copying the required values into the <em>/susaas-api/values.yaml</em> file (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/charts/susaas-api/values.yaml">click here</a>). In our sample scenario, the required environment specific properties are defined in the <em>values.yaml</em> file of the Helm Umbrella Chart. </p><p><strong>charts/sustainable-saas/susaas-api</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Chart.yaml # Chart.yaml of the SaaS API Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.schema.json # Schema definition for Values.yaml file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.yaml # Values.yaml of the SaaS API Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”€â”€â”€templatesâ”€â”€â”€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_helpers.tpl # Default Helm template helpers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api-rule.yaml # API Rule template exposing the SaaS API Service externally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.yaml # Deployment template for the SaaS API Service </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-auth-policy.yaml # Authorization Policy template allowing access by Istio Ingress Gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-sidecar.yaml # Default Sidecar limits required Istio configurations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network-policy.yaml # Network Policy allowing access by Istio Ingress Gateway only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-autoscaler.yaml # Horizontal Pod Autoscaler template based on CPU utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-disruption-budget.yaml # Pod Disruption Budget template for voluntary disruptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret.yaml # Secret template for potential Image Pull Secret </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-account.yaml # Service Account template for the SaaS API Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-binding.yaml # SAP BTP Service Binding template required by the SaaS API Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-keys.yaml # SAP BTP Service Binding template used to create standalone service keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.yaml # Cluster IP Service template for the SaaS API Service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Good to know</strong></p><ul><li><p>The Authorization Policy of the API Service is configured to allow access by Istio Ingress Gateway only. This opens the API Service to external traffic, as the associated Istio Virtual Service (created by the given API Rule), routes all requests to the Cluster IP Service of the SaaS API Service workload (except for scenarios integrating SAP API Management). </p></li><li><p>The Authorization Policy, as well as the respective API Rule, are only being used, if the SAP API Management integration is not enabled. For the integration of SAP API Management, the API Rule is replaced by a dedicated Virtual Service definition in the <em>apim-proxy</em> directory (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/charts/susaas-api/templates/apim-proxy">click here</a> or find details below). </p></li><li><p>The API Service Subchart contains a special Helm template allowing you to create Service Keys. If any <strong>serviceKeys</strong> value is defined in the <em>values.yaml</em>, a corresponding SAP BTP Service Binding will be created. This will create new Client Credentials but compared to regular Service Bindings (<strong>bindings</strong> property), the generated Secrets will not be mounted to the workload. </p></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>A Service Key is required for the Integration of SAP API Management, as dedicated Client Credentials of the API XSUAA Service Instance have to be stored in SAP API Management. This way, requests originating from SAP API Management can be securely authenticated. </p></div></div><p><strong>API Management Proxy</strong> </p><p>The API Management Proxy directory (<strong>apim-proxy</strong> - <a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/charts/susaas-api/templates/apim-proxy">click here</a>) contains various Istio templates to ensure a secure SAP API Management integration. As SAP API Management is a service running outside the Kyma Cluster, all requests targeting the SaaS API Service will initially leave the Kyma environment, and will return back to Kyma after the API Policies have been successfully checked (find more details below). </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">istio-auth-policy.yaml # Authorization Policy for traffic targeting the SaaS API workload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-dest-rule-apim.yaml # Destination Rule for traffic targeting SAP API Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-request-auth.yaml # Request Authentication for traffic targeting the SaaS API workload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-service-entry-apim.yaml # Service Entry to add SAP API Management as mesh external service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-virtual-service.yaml # Virtual Service for routing to SAP API Management or the SaaS API workload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To guarantee that no request can reach the API Service workloads without passing through SAP API Management, respective Istio resources ensure, that a valid JWT token is part of an incoming request. This JWT token is generated and injected by SAP API Management, based on Client Credentials of an XSUAA service instance. Below you can see a visualization, depicting how a request arriving through Istio Ingress Gateway is being processed.</p><p><img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/APIManagementArch.png&amp;quot; width=&amp;quot;800&amp;quot;/&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/APIManagementArch-dfeff21931d13dacdb290f1bbed61463.png" width="1362" height="734" class="img_ev3q"></p><ul><li><p>First of all, a so-called  <strong>Service Entry</strong> makes SAP API Management known as an external service to the Service Mesh. This allows us to it e.g., as destination target of Virtual Services. </p></li><li><p>To integrate SAP API Management, a dedicated <strong>Istio Virtual Service</strong> is used, routing traffic based on a custom header (x-jwt-assertion). In case the header is missing (initial request), the request is routed to SAP API Management. If the custom header is available, traffic is forwarded to the API Service workload. </p></li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>The custom header is injected by SAP API Management, after the request was processed and all Traffic Policies have been successfully checked.</p></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">```yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: networking.istio.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: VirtualService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Matches all requests arriving on host exposed by SusaaS API Service </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gateways: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - demo-dns/sap-demo-gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - susaas-api-default.sap-demo.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - match:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Matches requests with x-jwt-assertion header (custom header)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - headers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            x-jwt-assertion: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Routes requests to ClusterIP service of SusaaS API Service </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      route:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - destination:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host: susaas-api.default.svc.cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            port:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              number: 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Matches requests without x-jwt-assertion header (custom header)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - match:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - withoutHeaders:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            x-jwt-assertion: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Rewrite URL path to add API Proxy path and authority details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rewrite:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uri: /kyma-api-susaas/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        authority: sap-demo.prod.apimanagement.us20.hana.ondemand.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Routes to SAP API Management defined in the Service Entry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      route:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - destination:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host: sap-demo.prod.apimanagement.us20.hana.ondemand.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            port:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              number: 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>An Istio <strong>Request Authentication</strong> ensures, that all requests targeting the API Service workload are checked for a <strong>valid</strong> JWT token, provided by a trusted issuers. If this is the case, the incoming request is considered authenticated and respective identity details can be used in subsequent Authorization Policies. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>A Request Authentication without an Authorization Policy does not restrict access to your workloads. It only allows you to <strong>authenticate</strong> requests and ensures that JWT tokens are issued by a trusted issuer. The authentication details (like the identity available in the requestPrincipals property) can afterwards be validated in Authorization Policies. In case the JWT provider does not match a trusted issuer, the request will still be forwarded, but is considered &quot;un-authenticated&quot; not containing any identity details. </p></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> security.istio.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RequestAuthentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Any request targeting the Kyma API Service workload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Check if request contains a valid JWT token issued by XSUAA instance of the the Provider Subaccount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jwtRules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//sap</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo.authentication.us20.hana.ondemand.com/oauth/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">jwksUri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//sap</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo.authentication.us20.hana.ondemand.com/token_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># As the JWT token of the initial user request shall be retained a custom header is being used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">fromHeaders</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">jwt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">assertion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>An Istio <strong>Authorization Policy</strong> finally ensures, that the API Service workloads can only be reached by requests providing a specific Issuer and Subject (sub) claim as part of the previously validated JWT token. This can be handled by checking the requestPrincipals property, which is provided in the following structure \&lt;JWT-Issuer<!-- -->&gt;<!-- -->/\&lt;JWT-Subject<!-- -->&gt;<!-- -->. </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> security.istio.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AuthorizationPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ALLOW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Any request targeting the Kyma API Service workload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Only grant access if Issuer and Subject of the authenticated request match a defined pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The Issuer has to match the XSUAA token endpoint of the Provider Subaccount </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The prefix of the Subject has to match the appname of the API XSUAA Service Instance (incl. sb-prefix)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Will only be available if Request Authentication was successful</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requestPrincipals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//sap</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo.authentication.us20.hana.ondemand.com/oauth/token/sb</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">susaas</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">default</span><span class="token tag" style="color:#00009f">!*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>The Istio <strong>Destination Rule</strong> allows us to use simple TLS communication for egress traffic targeting SAP API Management. As Istio enforces mutual TLS as default communication within the mesh, any exception has to be explicitly defined. </p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-service-broker">API Service Broker<a href="#api-service-broker" class="hash-link" aria-label="Direct link to API Service Broker" title="Direct link to API Service Broker">â€‹</a></h2><p>The Sustainable SaaS API Service Broker is defined as a separate Helm Subchart. Theoretically, this Subchart can also be deployed standalone, by copying the required values into the <em>/susaas-broker/values.yaml</em> file (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/charts/susaas-broker/values.yaml">click here</a>). In this sample scenario, the required environment specific values are defined in the <em>values.yaml</em> file of the Umbrella Helm Chart. </p><p><strong>charts/sustainable-saas/susaas-broker</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Chart.yaml # Chart.yaml of the API Service Broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.schema.json # Schema definition for Values.yaml file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.yaml # Values.yaml of the API Service Broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”€â”€â”€templatesâ”€â”€â”€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_helpers.tpl # Default Helm template helpers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api-rule.yaml # API Rule template exposing the API Service Broker externally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker-catalog.yaml # API Service Broker catalog.json file template (e.g. service plans)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker-service.yaml # Config Map template for the API Service Broker (e.g. xssecurity extensions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.yaml # Deployment template for the API Service Broker </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-auth-policy.yaml # Authorization Policy template allowing access by Istio Ingress Gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-sidecar.yaml # Default Sidecar limits required Istio configurations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network-policy.yaml # Network Policy allowing access by Istio Ingress Gateway only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-autoscaler.yaml # Horizontal Pod Autoscaler template based on CPU utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-disruption-budget.yaml # Pod disruption budget template for voluntary disruptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret.yaml # Secret template for potential Image Pull Secret </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-account.yaml # Service Account template for the API Service Broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-binding.yaml # SAP BTP Service Binding template for the API Service Broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.yaml # ClusterIP Service template for the API Service Broker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Good to know</strong></p><ul><li><p>The Authorization Policy of the SusaaS API Service Broker is configured to allow access by Istio Ingress Gateway only. This exposes the service to external traffic, as the associated Istio Virtual Service (created by the provided API Rule), routes all requests to the Cluster IP Service of the API Service Broker workload. </p></li><li><p>The API Service Broker requires a Config Map Helm template, containing some extension definitions used by the Service Broker when generating new Client Credentials. </p></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>These configurations extend the default API Service Broker settings and ensure that the <strong>service plan</strong> (selected by the subscriber) is added as a scope to tokens issued for the respective service instance. Another extension adds the API URI to all issued client credentials of respective service instances (so we do not have to provide them the URI manually). </p></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">```yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceConfigs: | -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;susaas-api-default-a1b2c3d4&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;extend_credentials&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;shared&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Adds the SaaS API URI to client credentials as an additional information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;apiUrl&quot;: &quot;https://susaas-api-default.sap-demo.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;extend_xssecurity&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;per_plan&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             &quot;default&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;authorities&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  # Adds plan_default scope to tokens issued by &quot;default-plan&quot; service instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;$XSMASTERAPPNAME.plan_default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>An additional ConfigMap template (broker-catalog.yaml), results in a <em>catalog.json</em> file mounted to the file system of our API Service Broker containers. This dynamic ConfigMap contains information about all service plans offered by our API Service Broker. </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-router">Application Router<a href="#application-router" class="hash-link" aria-label="Direct link to Application Router" title="Direct link to Application Router">â€‹</a></h2><p>The Sustainable SaaS Application Router is defined in a separate Helm Subchart. This Subchart can also be deployed standalone, by copying the required values into the <em>/susaas-router/values.yaml</em> file (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/charts/susaas-router/values.yaml">click here</a>). In this sample scenario, the required environment specific values are defined in the <em>values.yaml</em> file of the Umbrella Helm Chart.</p><p><strong>charts/sustainable-saas/susaas-router</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Chart.yaml # Chart.yaml of the Application Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.schema.json # Schema definition for Values.yaml file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.yaml # Values.yaml of the Application Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”€â”€â”€templatesâ”€â”€â”€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_helpers.tpl # Default Helm template helpers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api-rule.yaml # API Rule template exposing the Application Router externally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.yaml # Deployment template for the Application Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-auth-policy.yaml # Authorization Policy template allowing access by Istio Ingress Gateway and Ory Oathkeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-dest-rule.yaml # Destination Rule template enforcing mTLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-sidecar.yaml # Default Sidecar limits required Istio configurations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network-policy.yaml # Network Policy template allowing access by Istio Ingress Gateway and Ory Oathkeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-autoscaler.yaml # Horizontal Pod Autoscaler template based on CPU utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-disruption-budget.yaml # Pod disruption budget template for voluntary disruptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret.yaml # Secret template for potential Image Pull Secret </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-account.yaml # Service Account template for the Application Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-binding.yaml # SAP BTP Service Binding template for the Application Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.yaml # Cluster IP Service template for the Application Router</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Good to know</strong></p><ul><li><p>The <strong>Authorization Policy</strong> of the Application Router is configured to allow access by Istio Ingress Gateway and Ory Oathkeeper Proxy only. This exposes the Application Router to public traffic, as the associated Istio Virtual Services (created by corresponding the Kyma API Rule), route all requests to the Cluster IP Service of the Application Router workload. Either directly or through Ory Oathkeeper in case of Subscriber Tenant access. Latter injects the required <strong>x-custom-host</strong> header.</p></li><li><p>Like the Backend Service, also the Application Router uses a dedicated <strong>Service Account</strong> instead of the <strong>default</strong> one. This allows the usage of the corresponding Service Account <strong>Principal</strong> in the Authorization Policy of our Backend Services. Doing so, we can ensure that only the Application Router can communicate with our Backend Service. </p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saas-backend-service">SaaS Backend Service<a href="#saas-backend-service" class="hash-link" aria-label="Direct link to SaaS Backend Service" title="Direct link to SaaS Backend Service">â€‹</a></h2><p>The Sustainable SaaS Backend Service is defined as a separate Helm Subchart. Like all the other Subcharts, also the Backend Service can be deployed standalone, by copying the required values in the <em>/susaas-srv/values.yaml</em> file (<a href="/PAA/@navyakhurana-patch-3/code/charts/sustainable-saas/charts/susaas-srv/values.yaml">click here</a>). In this sample scenario, the required environment specific values are defined in the <em>values.yaml</em> file of the Umbrella Helm Chart. </p><p><strong>charts/sustainable-saas/susaas-srv</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Chart.yaml # Chart.yaml for the SaaS Backend Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.schema.json # Schema definition for Values.yaml file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values.yaml # Values.yaml for the SaaS Backend Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”€â”€â”€templatesâ”€â”€â”€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_helpers.tpl # Default Helm template helpers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api-rule.yaml # API Rule template exposing the SaaS Backend Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster-role.yaml # Cluster Role template for permissions required during runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.yaml # Deployment template for the SaaS Backend Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-auth-policy.yaml # Authorization Policy template allowing access by Istio Ingress Gateway and Application Router only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-sidecar.yaml # Default Sidecar limits required Istio configurations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network-policy.yaml # Network Policy allowing access by Application Router and Istio Ingress Gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-autoscaler.yaml # Horizontal Pod Autoscaler template based on CPU utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-disruption-budget.yaml # Pod disruption budget template for voluntary disruptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">role-binding.yaml # Role Binding template to assign Cluster Role to Service Account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret.yaml # Secret template for potential Image Pull Secret </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-account.yaml # Service Account template for the SaaS Backend Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service-binding.yaml # SAP BTP Service Binding template for the SaaS Backend Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.yaml # ClusterIP Service template for the SaaS Backend Service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Good to know</strong></p><ul><li><p>The Sustainable SaaS Backend Service is using a separate <strong>Service Account</strong>, and the respective Service Account Token is <strong>auto-mounted</strong> (only workload requiring this). In combination with a separate <strong>Cluster Role</strong> (including permissions to manage API Rules) and a respective <strong>Role Binding</strong>, this enables the Backend Service to create <strong>API Rules</strong> for new subscribers at runtime. To learn more, check the <em>srv/utils/apiRule.js</em> implementation.</p></li><li><p>The <strong>Authorization Policy</strong> of our Backend Service allows access from the Application Router workloads only by restricting access to the corresponding principal. The only exception are the &quot;*/-/cds/.<!-- -->*<!-- -->*&quot; paths, which are accessible through Istio Ingress Gateway. This blocks public traffic access except for those dedicated paths. The associated Virtual Service (created by the provided API Rule) only redirects traffic on these specific paths to the Cluster IP Service of the Backend Service workloads. All other requests targeting the Backend Service, have to pass through the Application Router first. </p></li><li><p>The Application Router ensures that requests are properly authenticated by XSUAA (and enforces a login if required) and will handle multitenancy. The communication between Application Router and our Backend Service is unrestricted, as the Application Router principal has been added to the respective Authorization Policy. </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> security.istio.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AuthorizationPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Matches any request targeting the SaaS Backend Service workload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> srv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ALLOW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Allow Istio Ingress Gateway traffic to access all /-/cds/* paths</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Required for dependency callbacks and CDS related requests (e.g., extensions)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">/cds/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">principals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cluster.local/ns/istio</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system/sa/istio</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ingressgateway</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Grants access to all paths for traffic from Application Router </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;ns&quot; in the match pattern is the abbreviation for &quot;Namespace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;sa&quot; in the match pattern is the abbreviation for &quot;Service Account&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">principals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cluster.local/ns/default/sa/susaas</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">router</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-03-17T07:39:19.000Z">Mar 17, 2025</time></b> by <b>Navya Khurana</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/PAA/@navyakhurana-patch-3/project-panel/basic/kyma-resources-helm/components/ResourceOverview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Resource Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/PAA/@navyakhurana-patch-3/project-panel/basic/explore-the-components"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Explore the application components</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#umbrella-chart" class="table-of-contents__link toc-highlight">Umbrella Chart</a></li><li><a href="#api-service" class="table-of-contents__link toc-highlight">API Service</a></li><li><a href="#api-service-broker" class="table-of-contents__link toc-highlight">API Service Broker</a></li><li><a href="#application-router" class="table-of-contents__link toc-highlight">Application Router</a></li><li><a href="#saas-backend-service" class="table-of-contents__link toc-highlight">SaaS Backend Service</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/PAA/@navyakhurana-patch-3/">Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">SAP Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blogs.sap.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blogs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://answers.sap.com/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Q&amp;A<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discovery-center.cloud.sap/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discovery Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/SAP-samples/btp-kyma-cap-multitenant-susaas" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/PAA/@navyakhurana-patch-3/assets/js/runtime~main.09ce6886.js"></script>
<script src="/PAA/@navyakhurana-patch-3/assets/js/main.7708be93.js"></script>
</body>
</html>