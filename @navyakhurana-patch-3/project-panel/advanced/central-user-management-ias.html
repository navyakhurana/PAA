<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-project-panel/advanced/central-user-management-ias/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Central user management using SAP Identity Authentication Service | Build resilient apps with SAP BTP (PR: #6)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/advanced/central-user-management-ias"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Central user management using SAP Identity Authentication Service | Build resilient apps with SAP BTP (PR: #6)"><meta data-rh="true" name="description" content="In this part of the tutorial, you will learn how you as a SaaS Provider can set up a central user management using SAP Identity Authentication Service (SAP IAS). This makes your solution independent from SAP ID Service, which requires users of your SaaS consumers to sign up for an SAP-managed user account. Using SAP IAS you can manage (register, unregister, reset passwords, ...) all SaaS Consumer users in a central place."><meta data-rh="true" property="og:description" content="In this part of the tutorial, you will learn how you as a SaaS Provider can set up a central user management using SAP Identity Authentication Service (SAP IAS). This makes your solution independent from SAP ID Service, which requires users of your SaaS consumers to sign up for an SAP-managed user account. Using SAP IAS you can manage (register, unregister, reset passwords, ...) all SaaS Consumer users in a central place."><link data-rh="true" rel="icon" href="/PAA/@navyakhurana-patch-3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/advanced/central-user-management-ias"><link data-rh="true" rel="alternate" href="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/advanced/central-user-management-ias" hreflang="en"><link data-rh="true" rel="alternate" href="https://navyakhurana.github.io/PAA/@navyakhurana-patch-3/project-panel/advanced/central-user-management-ias" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SX6JA1B3F5-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Build resilient apps with SAP BTP (PR: #6)" href="/PAA/@navyakhurana-patch-3/opensearch.xml">

<script src="js/custom.js" async></script><link rel="stylesheet" href="/PAA/@navyakhurana-patch-3/assets/css/styles.f9497dcc.css">
<link rel="preload" href="/PAA/@navyakhurana-patch-3/assets/js/runtime~main.a9890a28.js" as="script">
<link rel="preload" href="/PAA/@navyakhurana-patch-3/assets/js/main.7708be93.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://github.com/navyakhurana/PAA/pull/6" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/PAA/@navyakhurana-patch-3/img/githubFolder.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/PAA/@navyakhurana-patch-3/img/githubFolder.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Develop a multitenant Software as a Service application in SAP BTP using CAP (PR: #6)</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/SAP-samples/btp-kyma-cap-multitenant-susaas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PAA/@navyakhurana-patch-3/">OVERVIEW Test Change-2</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/PAA/@navyakhurana-patch-3/category/project-panel">PROJECT PANEL</a><button aria-label="Toggle the collapsible sidebar category &#x27;PROJECT PANEL&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/discover">Discover</a><button aria-label="Toggle the collapsible sidebar category &#x27;Discover&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/basic">Basic</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basic&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/advanced">Advanced</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/introduction-advanced-version">Advanced Version Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/understand-repo-details">Advanced Version Repository details</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/prepare-provider-subaccount">Prepare the Provider Subaccount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/central-user-management-ias">Central user management using SAP Identity Authentication Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/push-data-s4hana-system">Push data from SAP S/4HANA system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/integrate-sap-api-management">Integrate SAP API Management</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/PAA/@navyakhurana-patch-3/category/expert">Expert</a><button aria-label="Toggle the collapsible sidebar category &#x27;Expert&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PAA/@navyakhurana-patch-3/support">SUPPORT</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/PAA/@navyakhurana-patch-3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/@navyakhurana-patch-3/category/project-panel"><span itemprop="name">PROJECT PANEL</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/PAA/@navyakhurana-patch-3/category/advanced"><span itemprop="name">Advanced</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Central user management using SAP Identity Authentication Service</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Central user management using SAP Identity Authentication Service</h1><p>In this part of the tutorial, you will learn how you as a SaaS Provider can set up a central user management using SAP Identity Authentication Service (SAP IAS). This makes your solution independent from SAP ID Service, which requires users of your SaaS consumers to sign up for an SAP-managed user account. Using SAP IAS you can manage (register, unregister, reset passwords, ...) all SaaS Consumer users in a central place. </p><ul><li><a href="#central-user-management-using-sap-identity-authentication-service">Central user management using SAP Identity Authentication Service</a><ul><li><a href="#1-sap-identity-authentication">1. SAP Identity Authentication</a></li><li><a href="#2-sap-ias-tenant-and-xsuaa-trust-setup">2. SAP IAS tenant and XSUAA trust setup</a></li><li><a href="#3-configure-the-xsuaa-and-ias-settings">3. Configure the XSUAA and IAS settings</a></li><li><a href="#4-update-helm-charts-and-run-upgrade">4. Update Helm Charts and run Upgrade</a></li><li><a href="#5-understand-the-registration-and-login-flow">5. Understand the registration and login flow</a></li><li><a href="#6-test-the-sap-ias-integration">6. Test the SAP IAS integration</a></li><li><a href="#7-why-that-complicated">7. Why that complicated?!</a></li><li><a href="#8-possible-enhancement-scenarios">8. Possible enhancement scenarios</a></li><li><a href="#9-further-information">9. Further information</a></li></ul></li></ul><p>The following tutorial will start with the technical setup requirements of the <strong>Advanced Version</strong> when it comes to the usage of SAP IAS before explaining the architecture and concepts in greater detail! We recommend going through the whole tutorial to understand what&#x27;s happening under the hood! To integrate SAP Identity Authentication Service as a central user management tool, please follow the upcoming sections.</p><ul><li>Understand the basics of SAP Identity Authentication Service.</li><li>If required, set up a new SAP IAS tenant and<ul><li>configure the trust between SAP IAS and your Provider Subaccount.</li><li>configure the trust between SAP IAS and your Consumer Subaccount.</li></ul></li><li>Disable the creation of Shadow Users for security purposes.</li><li>Configure the trusted domain of your Kyma Cluster in SAP IAS.</li><li>Ensure you understand the architecture and flow using SAP IAS.</li><li>Test the end-to-end scenario in a Subscriber Tenant.</li><li>Understand the reasons and complexity of the current setup.</li><li>Check out the possible enhancement scenarios of this setup.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-sap-identity-authentication">1. SAP Identity Authentication<a href="#1-sap-identity-authentication" class="hash-link" aria-label="Direct link to 1. SAP Identity Authentication" title="Direct link to 1. SAP Identity Authentication">​</a></h2><p><strong>What is SAP Identity Authentication</strong></p><p>What is SAP Identity Authentication Service? A crisp description can be found on the official SAP Identity Authentication Service Community page <a href="https://community.sap.com/topics/cloud-identity-services/identity-authentication" target="_blank" rel="noopener noreferrer">(click here)</a>. </p><blockquote><p><em>&quot;Identity Authentication is a cloud service for authentication, single sign-on, and user management in SAP cloud and on-premise applications. It can act as an identity Provider itself or be used as a proxy to integrate with an existing single sign-on infrastructure.&quot;</em></p></blockquote><p>So while SAP IAS <strong>can</strong> be used for user management and authentication like in our sample use-case, it can also act as a proxy and forward authentication requests to Identity Providers like an Active Directory. This feature allows you, to offer your SaaS consumers the option to integrate their own IdPs. This requirement will be briefly covered in the Expert Features of the tutorial. </p><p>For further information on SAP Identity Authentication Service please also check the official SAP Help documentation <a href="https://help.sap.com/docs/IDENTITY_AUTHENTICATION?locale=en-US" target="_blank" rel="noopener noreferrer">click here</a>.</p><p><strong>Advantages of using SAP IAS</strong></p><p>The usage of SAP IAS provides signification advantages for your SaaS application and for you as a SaaS Provider with some of them listed below:</p><ul><li>Centrally manage (e.g., register, unregister) all Consumer users for each SaaS application.<blockquote><p>Each SaaS application registered in SAP IAS can manage its own SaaS Consumer users.</p></blockquote></li><li>Customize the onboarding process (e.g., registration) and the user experience (e.g., login screens).</li><li>Define login procedures like social login or secure multi-factor authentication on a Consumer basis.</li><li>Include your consumer&#x27;s Identity Provider and set up custom login logic for each Consumer Subaccount.</li><li>Automate the SAP IAS instance, user, and application management using existing and upcoming APIs.</li><li>Simple integration/trust setup with Consumer Subaccounts using OpenID Connect (OIDC).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-sap-ias-tenant-and-xsuaa-trust-setup">2. SAP IAS tenant and XSUAA trust setup<a href="#2-sap-ias-tenant-and-xsuaa-trust-setup" class="hash-link" aria-label="Direct link to 2. SAP IAS tenant and XSUAA trust setup" title="Direct link to 2. SAP IAS tenant and XSUAA trust setup">​</a></h2><p>In case you already have an existing trust between SAP XSUAA of Provider Subaccount and your SAP IAS tenant, there are only a few additional steps to take when setting up a new Consumer account.</p><ul><li>Set up your central SAP IAS tenant as a trusted IdP in your Consumer Subaccounts.  </li><li>Disable the creation of shadow users in the SAP IAS trust configurations.  </li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>Make sure that the shadow user creation is <strong>also disabled in your Provider Subaccount</strong>! </p></div></div><p>In case you don&#x27;t have an SAP IAS tenant or you haven&#x27;t configured it as a trusted Identity Provider in your <strong>Provider and consumer</strong> subaccounts yet, please follow the steps below:</p><p>2.1. There are multiple ways to get an SAP IAS instance. Usually an SAP customer is supposed to have one productive SAP IAS instance in his SAP landscape. An SAP IAS instance can either be created right from within the SAP BTP Cockpit or a customer/partner gets it in a bundle with solutions like SAP SuccessFactors. </p><p>2.2. To check whether there&#x27;s already an SAP IAS tenant available which can be used for this scenario, please go to your Provider Subaccount and switch to the <strong>Trust Configuration</strong> in the <strong>Security</strong> section. Click on <strong>Establish Trust</strong>. If there is an SAP IAS tenant available in your landscape and a mapping between your SAP BTP Global Account and your SAP CRM customer number exists, you should be able to select it from the list. In that case please repeat the same process in each Consumer Subaccount and you&#x27;re done with the trust set up and you can skip steps 3.3 to 3.6. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>Don&#x27;t forget to continue with steps <em>4 - Disable Automatic Shadow User Creation</em> to finish the technical setup in your <strong>Provider and Consumer Subaccounts</strong>.</p></div></div><p>2.3. If there is no SAP IAS tenant available in the dropdown, you can create a new tenant from your Provider Subaccount or any other subaccount. Please switch to <strong>Instances and Subscriptions</strong> in the <strong>Services</strong> section and create a new service instance of type <strong>Cloud Identity Service</strong> with service plan <strong>default</strong>. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>If you&#x27;re missing this service or service plan, please make sure to add it to your subaccount entitlements. </p></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>While the <strong>default</strong> service plan will create a new SAP IAS tenant, the <strong>application</strong> service plan will create a new application registration in an SAP IAS tenant configured as a trusted IdP to the respective subaccount. </p></div></div><p>2.4. Decide if you want to set up a productive or test tenant of SAP Identity Authentication and click on <strong>Create</strong> to trigger the setup. </p><p>2.5. You or your SAP BTP Global Account administrator will receive a mail with instructions on how to initialize your new SAP IAS tenant once it is provisioned. The initial admin user can create further users or admins in SAP IAS. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ActivationMail.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ActivationMail-e7f73671ea4fe74c85e9c8ade8fa1c69.png" width="1124" height="785" class="img_ev3q"></p><p>2.6. Once the IAS tenant is provisioned, it will also appear in the dropdown list of your <strong>Trust Configuration</strong> and you can finish the trust set up in your Consumer and Provider Subaccounts.</p><p>2.7. Please make sure you&#x27;re able to log in to the SAP IAS Administration Console as an Administrator user by either initializing the SAP IAS tenant yourself or by requesting a respective user from your administrator.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-configure-the-xsuaa-and-ias-settings">3. Configure the XSUAA and IAS settings<a href="#3-configure-the-xsuaa-and-ias-settings" class="hash-link" aria-label="Direct link to 3. Configure the XSUAA and IAS settings" title="Direct link to 3. Configure the XSUAA and IAS settings">​</a></h2><p><strong>Disable Automatic Shadow User Creation</strong></p><p>Right after setting up the trust between your SAP IAS instance and your <strong>Provider</strong> and <strong>consumer</strong> subaccounts, please disable the <strong>Automated Creation of Shadow Users</strong> in the <strong>Trust Configuration</strong> of your SAP IAS trust settings. This is a one-time action, which you need to apply for each new Subscriber tenant!</p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ShadowUser01.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ShadowUser01-f8efc20721f9a05cdf8eecbe21b13d2e.png" width="1397" height="333" class="img_ev3q"></p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ShadowUser02.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ShadowUser02-7885ea361e01a479d2ebc6ff4be35fd4.png" width="608" height="313" class="img_ev3q"></p><p>An Automated creation of shadow users would result in a setup in which each and every SAP IAS user can authenticate to each Consumer Subaccount. As your central SAP IAS instance contains the users of all consumers, this is not desirable! Instead, we will create the subaccount-specific shadow users upon user creation in the SaaS in-app user management. While this is a bit more coding an maintenance effort, it provides a much more reliable and secure setup.</p><p><strong>Configure trusted domains in SAP IAS</strong></p><p>To allow an automated forwarding of users to the respective tenant SaaS instances after registration in SAP IAS, you need to add your SaaS application domain as a trusted domain in the SAP IAS <strong>Tenant Settings</strong>. Therefore, please login to SAP Identity Authentication Service as an Administrator and follow the screenshots below. SAP IAS will only allow redirects to domains which have been explicitly whitelisted in the Tenant Settings.</p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_TrustedDomain01.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_TrustedDomain01-a62b2aef7b46e1535fe40583cd4e484b.png" width="1277" height="795" class="img_ev3q">
<img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_TrustedDomain02.png&amp;quot; width=&amp;quot;500&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_TrustedDomain02-8308117e5ee77862653eed7b69ed4abf.png" width="1207" height="360" class="img_ev3q"></p><p>If required for increased security, don&#x27;t use your Kyma subdomain with a wildcard, but specify the full qualified hostname including the different tenant-identifiers. Alternatively you can also use your own custom domain. For information can be found in SAP Help (<a href="https://help.sap.com/docs/IDENTITY_AUTHENTICATION/6d6d63354d1242d185ab4830fc04feb1/08fa1fe816704d99a6bcab245158ebca.html?locale=en-US" target="_blank" rel="noopener noreferrer">click here</a>).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-update-helm-charts-and-run-upgrade">4. Update Helm Charts and run Upgrade<a href="#4-update-helm-charts-and-run-upgrade" class="hash-link" aria-label="Direct link to 4. Update Helm Charts and run Upgrade" title="Direct link to 4. Update Helm Charts and run Upgrade">​</a></h2><p>As already described in the <a href="/PAA/@navyakhurana-patch-3/project-panel/advanced/understand-repo-details">Advanced Version Repository details</a> chapter, a few changes to your Umbrella Helm Chart <em>values.yaml</em> file are required to enable the usage of SAP Identity Authentication Service. Enabling the following configuration will create a new <strong>Cloud Identity</strong> service instance of type <strong>application</strong> upon <em>helm install</em> or <em>helm upgrade</em>. </p><p>4.1. A <strong>Cloud Identity</strong> service instance creates a new Application Registration in the SAP IAS tenant which is configured as Trusted Identity Provider of the given subaccount. Using the X.509 certificate of a respective Service Binding of this Cloud Identity Service instance, allows you to call the API endpoints of SAP IAS, to register or delete new users on behalf of the Application Registration. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>The Integration with SAP Identity Authentication requires additional entitlements in your SAP BTP Subaccount as well as a SAP Identity Authentication tenant.</p></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># SAP Cloud Identity Service Instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Provides an SAP IAS integration for central user management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">identity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Enable if an SAP IAS instance is configured as Trusted Identity Provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceOfferingName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">servicePlanName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>4.2. Continue by updating your Backend Service settings, which results in a Service Binding between your <strong>Backend Service</strong> and the above <strong>Cloud Identity</strong> service instance upon <em>helm install</em> or <em>helm upgrade</em>. In this case a special binding type (X.509) is required, while for all other bindings we are using standard Client Credential bindings. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>The Integration with SAP Identity Authentication requires both additional entitlements in your SAP BTP Subaccount as well as a SAP Identity Authentication tenant.</p></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">srv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">bindings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">xsuaa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">serviceInstanceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xsuaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">identity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Only enable if Cloud Identity Service instance is enabled in Umbrella Chart </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">serviceInstanceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># SAP IAS binding requires X.509 certificate based credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">credential-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> X509_GENERATED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>4.3. Okay, once you&#x27;re done with these to changes, please run a <em>helm upgrade</em> command, to update your workloads and to create the new <strong>Cloud Identity</strong> Service Instance and respective Service Bindings. </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade &lt;ReleaseName&gt; ./charts/sustainable-saas -n &lt;Namespace&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In your <strong>Service Instances</strong> you should now see a new instance of type <strong>identity</strong> and plan <strong>application</strong>, which has a <strong>Service Binding</strong> to your Backend Service. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_InstanceKyma.png&amp;quot; width=&amp;quot;400&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_InstanceKyma-b61b8b4dd4497c39644041433612a886.png" width="1273" height="966" class="img_ev3q"></p><p>4.4. This is it! All the magic is now happening under the hood. Feel free to check out the user-management utilities (<a href="/PAA/code/srv/utils/user-management.js">click here</a>) to see which additional code snippets are being executed in case of an existing Service Binding to a Cloud Identity Service Instance. Just search for &quot;<strong>this.ias</strong>&quot; and you will see how SAP IAS is integrated into the user management/creation/deletion flow. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-understand-the-registration-and-login-flow">5. Understand the registration and login flow<a href="#5-understand-the-registration-and-login-flow" class="hash-link" aria-label="Direct link to 5. Understand the registration and login flow" title="Direct link to 5. Understand the registration and login flow">​</a></h2><p>See the following screenshots to get an idea of the user management architecture and to understand how registration as well as authentication works in the sample application including SAP IAS (click to enlarge). </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/APP_Architecture.png&amp;quot; width=&amp;quot;500&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/APP_Architecture-b2b19061f107b465d03a4fc64bfc049b.png" width="2686" height="1368" class="img_ev3q"></p><p> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_Architecture.png&amp;quot; width=&amp;quot;400&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_Architecture-ae4cfc0c18e819c9792cd36aba6ebd39.png" width="903" height="629" class="img_ev3q"></p><p>Compared to the Basic Version, the <strong>Advanced Version</strong> relies on the usage of a central SAP Identity Authentication tenant. This central SAP IAS instance is managed by the SaaS Provider and added to each Consumer Subaccount as a trusted IdP. This allows all SAP IAS users to authenticate against Consumer Subaccounts using SAP IAS instead of the default SAP ID Service. As you&#x27;ve learned in the Basic Version, the intention of the sample application is to offer in-app user management. For that reason also SAP IAS has to be part of the existing automation. So whenever a user is created or deleted in the SaaS application, it now also needs to be registered or unregistered from the corresponding SAP IAS application registration. So let&#x27;s have a closer look at the registration and authentication process in case of the new user being added to the SaaS in-app user management. </p><p>5.1. Let&#x27;s assume the admin Jane of SaaS Consumer <strong>ABC</strong> creates a new user <strong>Chuck</strong> in the in-app user management of their Consumer SaaS instance. Consequently, a new user in SAP IAS has to be <em>registered/created</em> and a so-called <strong>shadow user</strong> in XSUAA has to be <em>created</em>. </p><blockquote><p>You might ask yourself - Why do we need to manage users in SAP IAS and in XSUAA? In this sample, we decided to maintain the shadow users on the XSUAA side manually. While SAP IAS is used as a central user store <strong>for all SaaS consumers</strong>, this manual approach ensures that only the users that exist as shadow users in the corresponding Consumer Subaccount can access the application. In the sample flow (see above), <strong>James</strong> exists as a user in SAP IAS and as a <strong>shadow user</strong> in the XYZ Consumer Subaccount. This gives him access to the Consumer SaaS instance in subaccount XYZ. On the other side, Chuck and Jane of Consumer ABC will not be able to access XYZ&#x27;s SaaS instances, because no corresponding shadow users exist for them in the respective subaccount.</p></blockquote><p>5.2. Understanding the basic idea of SAP IAS and XSUAA shadow users, let&#x27;s check how the actual flow continues once Jane added the new user Chuck within ABC&#x27;s SaaS in-app user management. </p><p>Using a binding to a service instance of type <strong>Cloud Identity Service</strong> (application plan) defined in the <strong>values.yaml</strong> files of our Umbrella Helm Chart, the SaaS backend is able to interact with the central SAP IAS tenant. A Cloud Identity Service instance with service plan <em>application</em> can only be created in subaccounts with an SAP IAS instance configured as a trusted Identity Provider. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ServiceInstance.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ServiceInstance-54a009f6e24acf3188b4faefae629477.png" width="1627" height="650" class="img_ev3q"></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>When setting up the SAP IAS trust in the SAP BTP <strong>Trust Configuration</strong>, an application registration in SAP IAS is created, which is used for authentication to all XSUAA-based applications in the subaccount. </p></div></div><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ProviderTrust.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ProviderTrust-0978b5b3b22b44bf0524d8cbd69866d9.png" width="1584" height="511" class="img_ev3q"></p><p>Additionally, the Cloud Identity Service instance (application plan) defined in the mta.yaml of our sample application creates another application registration in SAP IAS during deployment. This service instance is bound to the SaaS backend and is used to programmatically interact with SAP IAS (e.g., to register or unregister users)</p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ServiceAppReg01.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ServiceAppReg01-91a31981b2c632938aab042337c657ab.png" width="1687" height="774" class="img_ev3q"></p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_ServiceAppReg02.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_ServiceAppReg02-ad6fff847490d5de561749bffce589a6.png" width="2056" height="1068" class="img_ev3q"></p><p>Binding such a service instance to the SaaS backend will give you access to an X.509 certificate. Using this X.509 certificate, the SaaS backend can call SAP IAS APIs (e.g. to register or unregister users) on behalf of the application registration which is created in SAP IAS by the service broker.</p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_BindingCert01.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_BindingCert01-7bf978651cdea12d591deda46fd5fda4.png" width="1941" height="1215" class="img_ev3q"></p><p>As you can see in the screenshot below, the X.509 certificate generated during the binding process, allows you to manage the application registration in SAP IAS and manage (register, unregister) users on behalf of the application registration. Keep in mind, this application registration in SAP IAS is created during the deployment of the SaaS application and is independent of the various application registrations created by trust setups between XSUAA and SAP IAS for each subaccount. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_BindingCert02.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_BindingCert02-9b46aaf0d1982a634060a4dc1e90b48e.png" width="1600" height="760" class="img_ev3q"></p><p>Being able to programmatically interact with SAP IAS, the SaaS backend can create a new user in SAP IAS on behalf of the app-specific application registration. Once the user <strong>Chuck</strong> is registered in SAP IAS, he receives an automated email, asking him to complete the SAP Identity Authentication registration. This e-mail (style and content) can be customized by the SaaS Provider. </p><blockquote><p><strong>Summary</strong> - For <strong>all Consumer Subaccounts</strong> there is a separate application registration in SAP IAS (created by the trust between XSUAA and SAP IAS). These application registrations are <strong>used for authentication</strong> to the XSUAA-protected SaaS instances in the different Consumer Subaccounts!
Additionally, for <strong>each SaaS application</strong>, one dedicated application registration is created in SAP IAS which is being <strong>used to register and unregister users</strong> in SAP IAS across all SaaS consumers in an automated fashion!</p></blockquote><p>5.3. While the user registration process is triggered in SAP IAS, <strong>Chuck</strong> is also created as a <strong>shadow user</strong> in the dedicated XSUAA user base of the ABC Consumer Subaccount and the respective <strong>role collection</strong> is assigned. For this shadow user, the central SAP IAS tenant (<em>Custom IAS tenant</em> managed by the Provider) is chosen as <strong>Identity Provider</strong> instead of the default SAP ID Service (<strong>Basic Version</strong>). </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_UserCustomIdP.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_UserCustomIdP-62ce95a12bd460046f89c67f3cbb3bea.png" width="734" height="368" class="img_ev3q"></p><p>Based on the XSUAA - SAP IAS trust setup and a dedicated shadow user in XSUAA of the Consumer Subaccount, SAP IAS (acting as IdP) can now be used to authenticate requests to XSUAA-based applications like the SaaS sample application - As long as the shadow user exists and has the required role collections assigned. </p><p>5.4. After successful registration, <strong>Chuck</strong> can now authenticate to the SaaS Tenant of Consumer ABC using SAP IAS as trusted IdP. This is where things are a bit tricky to understand, so please excuse if some explanations are repeated. </p><p>As explained - while we&#x27;re using a dedicated SAP IAS application registration for user management (register, unregister, ...), we cannot use the same application registration for authentication processes. </p><p>SaaS users have to authenticate using the application registration created when the trust between a Consumer Subaccount and SAP IAS is initiated - as XSUAA will propagate the authentication to SAP IAS (acting as IdP) using this Consumer Subaccount-specific application registration. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_SubscriberTrust.png&amp;quot; width=&amp;quot;300&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_SubscriberTrust-d5158746b242433e78fa9e8f33147cdb.png" width="1583" height="509" class="img_ev3q"></p><p>Until a native integration of SAP IAS into CAP (incl. role management in SAP IAS) is in place, the authentication using the Consumer Subaccount-specific application registration has to be used. This application registration can unfortunately not be used for automated user management at the same time, as it does not manifest in a service instance on the SAP BTP side. </p><p>Okay wow, that was a lot of information to digest. Let&#x27;s summarize the steps again!</p><ul><li>A new user is created from within the SaaS in-app user management by a Consumer administrator.</li><li>It is registered in SAP IAS, using the X.509 certificate of a Cloud Identity service binding.</li><li>In the Consumer Subaccount, an XSUAA shadow user is created and role collections are assigned.</li><li>The user registers himself in SAP IAS after retrieving an automated invitation mail.</li><li>The user can now authenticate using the application registration created by the Consumer Subaccount XSUAA - SAP IAS trust.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-test-the-sap-ias-integration">6. Test the SAP IAS integration<a href="#6-test-the-sap-ias-integration" class="hash-link" aria-label="Direct link to 6. Test the SAP IAS integration" title="Direct link to 6. Test the SAP IAS integration">​</a></h2><p>Before testing the SAP IAS integration, please double check whether your meet the following prerequisites.</p><ul><li>SAP Identity Authentication instance with administrator access (<a href="#1-sap-identity-authentication">click here</a>)</li><li>Existing trust configuration between Provider Subaccount and SAP IAS (<a href="#2-sap-ias-tenant-and-xsuaa-trust-setup">click here</a>)</li><li>Existing trust configuration between Subscriber Subaccount and SAP IAS (<a href="#2-sap-ias-tenant-and-xsuaa-trust-setup">click here</a>)</li><li>Automated Shadow User Creation disabled for all trust configurations (<a href="#3-configure-the-xsuaa-and-ias-settings">click here</a>)</li><li>Domain of your SaaS application added as trusted domain in SAP IAS (<a href="#3-configure-the-xsuaa-and-ias-settings">click here</a>)</li><li>Helm Umbrella Chart updated and Helm Release successfully upgraded (<a href="#4-update-helm-charts-and-run-upgrade">click here</a>)</li><li>Cloud Identity Service Instance and Service binding available in Kyma (<a href="#4-update-helm-charts-and-run-upgrade">click here</a>)</li><li>Basic understanding of the registration and login flow (<a href="#5-understand-the-architecture-and-login-flow">click here</a>)</li><li>Existing Tenant Subaccount with Sustainable SaaS Subscription (<a href="/PAA/@navyakhurana-patch-3/project-panel/basic/subscribe-consumer-subaccount">click here</a>)</li></ul><p>All set? Great - then let&#x27;s check whether the SAP IAS Integration works as expected! </p><p>6.1. Switch to your (Test) Tenant Subaccount and make sure you have the SusaaS Administrator Role assigned and to test things in a new browser session or Incognito mode. </p><p>6.1. Open the SaaS application in one of your Subscriber Subaccounts using the <strong>Instances and Subscriptions</strong> section of your SAP BTP Cockpit. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/SUB_InitApp.png&amp;quot; width=&amp;quot;400&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/SUB_InitApp-515de9a4075ae97b2a1318b70d5341b1.png" width="1059" height="550" class="img_ev3q"></p><p>6.2. As you have setup a trust between the XSUAA environment of your Subscriber Subaccount and the central SAP IAS tenant, you should now be facing a new selection screen, asking you which Identity Provider to use for authentication. As you did not create a SAP IAS user so far, please continue with the <strong>Default Identity Provider</strong> and login with your default SAP Identity Service credentials. </p><p>6.3. Switch to the <strong>Manage Users</strong> interface and create a new user. For testing purposes, feel free to set up a second user for yourself, but make sure to use <strong>a different e-mail address</strong> this time! </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_CreateUser01.png&amp;quot; width=&amp;quot;200&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_CreateUser01-f66d3489508506bdaa8cda84710b9584.png" width="557" height="507" class="img_ev3q">
<img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_CreateUser02.png&amp;quot; width=&amp;quot;250&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_CreateUser02-287045558b1b879ecc7376ae731d4fe9.png" width="897" height="665" class="img_ev3q"></p><p>6.4. Once the new user is successfully created, check your e-mail inbox, which should contain a message from the central SAP Identity Authentication Service instance. In this e-mail, the you will be asked to sign-up for the Sustainable SaaS application. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>The style and content of this e-mail can be modified for each application registration in SAP Identity Authentication Service (<a href="https://help.sap.com/docs/IDENTITY_AUTHENTICATION/6d6d63354d1242d185ab4830fc04feb1/b2afbcdccdf7410f8953e1e833e77de0.html?locale=en-US" target="_blank" rel="noopener noreferrer">click here</a>). </p></div></div><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_Email01.png&amp;quot; width=&amp;quot;390&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_Email01-de9bc2304349f411539541c6513294ed.png" width="1024" height="701" class="img_ev3q"></p><p>6.5. Click on the provided link, to reach the registration form in which you can change your first and last name if required and set a password for the SAP Identity Authentication Service account. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_Registration.png&amp;quot; width=&amp;quot;390&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_Registration-a74cbe7e4a51db9ad7bbb8770870008b.png" width="948" height="884" class="img_ev3q"></p><p>6.6. Once you completed the registration, a success message is displayed and the page can be closed. Alternatively, you can click on <strong>Continue</strong>, to be redirected to the SaaS application instance of your Subscriber Tenant. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_RegSuccess.png&amp;quot; width=&amp;quot;390&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_RegSuccess-9073e8c8b26bf6e77585d1119dfe1a4d.png" width="948" height="603" class="img_ev3q"></p><p>6.7. Now the new user can log in to the Consumer Tenant instance using the SAP IAS credentials. In the respective selection screen, now just simply select your SAP IAS tenant instead of the <strong>Default Identity Provider</strong>. </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_LoginSubscr.png&amp;quot; width=&amp;quot;390&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_LoginSubscr-0a401644b762a46dadc74b303d332e5c.png" width="892" height="544" class="img_ev3q"></p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>Hint</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>You will not see the name of the SaaS application registration in the authentication screen but the name of the application registration created by the XSUAA - SAP IAS trust setup. This relates to the <a href="/PAA/@navyakhurana-patch-3/project-panel/advanced/central-user-management-ias#6-architecture-and-flow">Architecture Setup</a> described in chapter <em>Central user management using SAP Identity Authentication Service</em>. This screen can also be customized in SAP Identity Authentication Service (<a href="https://help.sap.com/docs/IDENTITY_AUTHENTICATION/6d6d63354d1242d185ab4830fc04feb1/32f8d337f0894d269f5f89956803efac.html?locale=en-US" target="_blank" rel="noopener noreferrer">click here</a>).</p></div></div><p>6.8. As a <strong>Provider administrator</strong> you will see the new user in your XSUAA user management using the SAP BTP Cockpit. In the following screenshot, you can see that the Provider administrator (using the Default Platform Identity Provider -&gt; SAP ID Service) has set up the new user (now assigned to the Custom Identity Provider -&gt; SAP Identity Authentication). </p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_XSUAAUsers.png&amp;quot; width=&amp;quot;390&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_XSUAAUsers-20a8e698bea4275b504e27cbd3e85f84.png" width="1903" height="865" class="img_ev3q"></p><p>6.9. As an Administrator, log in to SAP Identity Authentication Service - Administration Console and you can see the new user in the User Management section of SAP IAS. Switching to the <strong>Applications</strong> tab you will notice that the user has been <strong>registered</strong> by the <em>Sustainable SaaS</em> application but authenticates using the consumer-specific <em>XSUAA_&lt; Subaccount-Name &gt;</em> application.</p><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_UserDetails.png&amp;quot; width=&amp;quot;390&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_UserDetails-2867829bebf71a4a185850fe60b8d50a.png" width="988" height="718" class="img_ev3q"></p><p>6.10. To skip the Identity Provider selection screen using SAP IAS as default Identity Provider, please disable the login using SAP ID Service in the <strong>Trust Configuration</strong> settings of the respective Tenant Subaccount. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><mdxadmonitiontitle><strong>Important</strong> </mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>Please keep in mind, changing this setting that your initial user (mapped to SAP Identity Service) cannot log in to the Tenant subscription instance anymore.</p></div></div><p> <img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_DisableLogon01.png&amp;quot; width=&amp;quot;500&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_DisableLogon01-4d936443e405944d996e0e6884e9ab64.png" width="1397" height="333" class="img_ev3q">
<img loading="lazy" alt="&amp;lt;img src=&amp;quot;./images/IAS_DisableLogon02.png&amp;quot; width=&amp;quot;280&amp;quot; /&amp;gt;" src="/PAA/@navyakhurana-patch-3/assets/images/IAS_DisableLogon02-b26d7c559f03fe0e3ea2cb39e109413d.png" width="601" height="274" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-why-that-complicated">7. Why that complicated?!<a href="#7-why-that-complicated" class="hash-link" aria-label="Direct link to 7. Why that complicated?!" title="Direct link to 7. Why that complicated?!">​</a></h2><p>Yes, we have to admit, the setup is a bit complicated and not easy to understand at first glance. Still, it offers certain advantages that we want to highlight here. </p><p>7.1. Why not use the existing XSUAA - SAP IAS trust application registration for the SAP IAS API access?</p><ul><li>While technically this is a possible option, it is currently not automatable and has some further drawbacks outlined below! As described, in our setup we&#x27;re using the X.509 certificate of the Cloud Identity service binding (application plan) to access SAP IAS APIs from the SaaS backend application. Setting up the trust between XSUAA and SAP IAS <strong>does not</strong> result in a bindable service instance. Therefore, the certificate or client credentials need to be manually created and rotated in SAP IAS and stored on the SAP BTP side. Not ideal! </li></ul><p>7.2. Why is a separate application registration used for each SaaS application to register users in SAP IAS?</p><ul><li><p>Besides the automation goodie described above, this approach has also other good reasons. First of all, it allows you to customize e-mail templates and forms of each SaaS application that a SaaS Provider is offering. Furthermore, this setup supports scenarios in which a user is supposed to use multiple SaaS apps in a Consumer Subaccount. What does that mean?</p><p>Let&#x27;s assume that only one single application registration (e.g. the one of the XSUAA - SAP IAS trust) is used to register and unregister the users of multiple SaaS applications. If you unregister a user from that application registration, it will be instantly removed from the SAP IAS user store. This happens because SAP IAS removes a user from the user store, once he&#x27;s unregistered from the last application registration. Result - The user cannot log in any more!</p><p>Having multiple application registrations for each SaaS application and assigning a user separately to each of them, will mitigate this issue. The user will still be able to authenticate to the remaining SaaS apps as long as he&#x27;s not removed from all application registrations. </p></li></ul><p>7.3. Isn&#x27;t there a way to manage SAP IAS users using an SAP IAS administration API endpoint?</p><ul><li>Sure, there is a way to do that. SAP IAS provides an API endpoint that allows you to create new users in the user store instead of registering them on behalf of an application registration. Nevertheless, to use that API endpoint an additional manual step requires you to create a technical user in SAP IAS and to store and rotate its credentials on the SAP BTP side. Furthermore, you will miss the nice feature of registering users to an application, which will trigger an e-mail to the new user that you can customize. </li></ul><p>7.4. Does that mean we can also customize the login behavior (screens or flows like social login) for each SaaS application?</p><ul><li>No, this is currently not possible as these application registrations (unique per application and not per consumer) are only used for (un-)registering users in SAP IAS but not for authentication. As of today, if a user wants to authenticate to a SaaS application protected by XSUAA, he has to authenticate using application registration created by the XSUAA - SAP IAS trust. As explained, this means one SAP IAS application registration is used for the authentication of <strong>all applications</strong> in a Consumer Subaccount. While this is a minor downside as e.g. certain SaaS applications might have stricter authentication requirements than others, it still allows you to at least define different authentication flows per Consumer Subaccount. </li></ul><p>7.5. Will this setup be simplified/enhanced in the future? </p><ul><li>Probably yes - but there is no concrete timeline yet. Once there is an end-to-end integration (incl. role management) between SAP IAS and frameworks like CAP (currently XSUAA-based), a dedicated application registration for each SaaS application might be a viable option for future authentication and user management. This will allow users to directly authenticate against the same application registration which is also used for managing the users in SAP IAS. </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-possible-enhancement-scenarios">8. Possible enhancement scenarios<a href="#8-possible-enhancement-scenarios" class="hash-link" aria-label="Direct link to 8. Possible enhancement scenarios" title="Direct link to 8. Possible enhancement scenarios">​</a></h2><p>This setup is only one sample of how to approach a central user store using SAP Identity Authentication Service. Still, there are further options to enhance or modify this scenario depending on your own requirements. Let&#x27;s check out some of them. </p><p>8.1. Provide a separate SAP IAS tenant to each and every Consumer. In case one of your consumers wants to have the ownership and management capabilities of its user base, you can provide access to a separate SAP IAS tenant. In this case, you need to ensure, that you set up the trust between the Consumer Subaccount and the dedicated Consumer SAP IAS instance. </p><p>In-app user management will not work out of the box in this case, as the SaaS backend application (running in the Provider Subaccount) will not be able to create an application registration within the Consumer SAP IAS tenant. In that case, you need to modify the implementation to support the following scenarios:</p><ul><li>Manually create an application registration for user management in the SAP IAS Consumer tenant and store the respective credentials on the Consumer Subaccount side (e.g., in a Destination or Credential Store instance). Use the credentials in the SaaS application to allow in-app user management again. </li><li>Make use of group assignments in the dedicated SAP IAS Consumer tenant. Applying the corresponding XSUAA group mapping in the Consumer Subaccount will make the role assignment work again. Also, this approach requires changes in the coding, as you will need to implement additional API calls to SAP IAS for the respective group assignment. In the case of a dedicated SAP IAS tenant, you can enable the automatic creation of shadow users, skipping the manual user creation on the XSUAA side.</li></ul><p>8.2. Allow consumers to bring their own Identity Providers. For large SaaS consumers, this might be a preferred option, as they don&#x27;t need to manage users manually in the SaaS application but access will be granted based on group memberships. </p><ul><li>In-app user management will either not be required or needs to be modified in this case. If required, the SaaS application needs to be enhanced in a way that supports the consumer&#x27;s IdP APIs for user creation and/or group assignment. While this is not necessarily impossible, it cannot be covered by this sample application. The integration of a custom Identity Provider can either happen on the XSUAA level, which lets you skip SAP IAS, or within SAP IAS. SAP IAS will act as a proxy and forward the authentication to the consumer&#x27;s IdP (find more details in the <strong>Expert Features</strong>).</li></ul><p>8.3. Use SAP IAS as a central user store and switch to an authentication approach based on user group mappings. This will allow you to skip the assignment of role collections to shadow users on the XSUAA side but will cause more management effort on the SAP IAS side. </p><ul><li>Using dedicated user groups in SAP IAS like &quot;Admin_ConsumerABC&quot; and &quot;Admin_ConsumerXYZ&quot;, you can set up a corresponding group mapping in the respective subaccounts of consumers ABC and XYZ. Instead of manually assigning role collections to your XSUAA shadow users, the only thing that needs to be done now is to map the role collections of the SaaS application to the consumer-specific user groups. Certain changes in the code will be required to automate the creation of consumer-specific user groups in SAP IAS and connect your in-app user management with the group assignment logic of SAP IAS. In this scenario, you need to ensure, that users in SAP IAS are assigned to the correct user group.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-further-information">9. Further information<a href="#9-further-information" class="hash-link" aria-label="Direct link to 9. Further information" title="Direct link to 9. Further information">​</a></h2><p>Please use the following links to find further information on the topics above:</p><ul><li><a href="https://help.sap.com/docs/SAP_CLOUD_IDENTITY?locale=en-US" target="_blank" rel="noopener noreferrer">SAP Help - SAP Cloud Identity Services</a></li><li><a href="https://community.sap.com/topics/cloud-identity-services/identity-authentication" target="_blank" rel="noopener noreferrer">SAP Community - SAP Cloud Identity Services - Identity Authentication</a></li><li><a href="https://help.sap.com/docs/IDENTITY_AUTHENTICATION?locale=en-US" target="_blank" rel="noopener noreferrer">SAP Help - SAP Cloud Identity Services - Identity Authentication</a></li><li><a href="https://help.sap.com/docs/BTP/65de2977205c403bbc107264b8eccf4b/cb1bc8f1bd5c482e891063960d7acd78.html" target="_blank" rel="noopener noreferrer">SAP Help - Trust and Federation with Identity Providers</a></li><li><a href="https://help.sap.com/docs/BTP/65de2977205c403bbc107264b8eccf4b/161f8f0cfac64c4fa2d973bc5f08a894.html?locale=en-US" target="_blank" rel="noopener noreferrer">SAP Help - Establish Trust and Federation Between UAA and Identity Authentication</a></li><li><a href="https://help.sap.com/docs/BTP/65de2977205c403bbc107264b8eccf4b/d8525671e8b14147b96ef497e1e1af80.html" target="_blank" rel="noopener noreferrer">SAP Help - Switch Off Automatic Creation of Shadow Users</a></li><li><a href="https://help.sap.com/docs/IDENTITY_AUTHENTICATION/6d6d63354d1242d185ab4830fc04feb1/08fa1fe816704d99a6bcab245158ebca.html?locale=en-US" target="_blank" rel="noopener noreferrer">SAP Help - Configure Trusted Domains</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-02-19T09:06:11.000Z">Feb 19, 2025</time></b> by <b>Navya Khurana</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/prepare-provider-subaccount"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Prepare the Provider Subaccount</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/PAA/@navyakhurana-patch-3/project-panel/advanced/push-data-s4hana-system"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Push data from SAP S/4HANA system</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-sap-identity-authentication" class="table-of-contents__link toc-highlight">1. SAP Identity Authentication</a></li><li><a href="#2-sap-ias-tenant-and-xsuaa-trust-setup" class="table-of-contents__link toc-highlight">2. SAP IAS tenant and XSUAA trust setup</a></li><li><a href="#3-configure-the-xsuaa-and-ias-settings" class="table-of-contents__link toc-highlight">3. Configure the XSUAA and IAS settings</a></li><li><a href="#4-update-helm-charts-and-run-upgrade" class="table-of-contents__link toc-highlight">4. Update Helm Charts and run Upgrade</a></li><li><a href="#5-understand-the-registration-and-login-flow" class="table-of-contents__link toc-highlight">5. Understand the registration and login flow</a></li><li><a href="#6-test-the-sap-ias-integration" class="table-of-contents__link toc-highlight">6. Test the SAP IAS integration</a></li><li><a href="#7-why-that-complicated" class="table-of-contents__link toc-highlight">7. Why that complicated?!</a></li><li><a href="#8-possible-enhancement-scenarios" class="table-of-contents__link toc-highlight">8. Possible enhancement scenarios</a></li><li><a href="#9-further-information" class="table-of-contents__link toc-highlight">9. Further information</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/PAA/@navyakhurana-patch-3/">Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">SAP Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blogs.sap.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blogs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://answers.sap.com/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Q&amp;A<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discovery-center.cloud.sap/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discovery Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/SAP-samples/btp-kyma-cap-multitenant-susaas" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/PAA/@navyakhurana-patch-3/assets/js/runtime~main.a9890a28.js"></script>
<script src="/PAA/@navyakhurana-patch-3/assets/js/main.7708be93.js"></script>
</body>
</html>